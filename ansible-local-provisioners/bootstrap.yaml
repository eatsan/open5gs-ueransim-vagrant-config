---
- name: Open5gs bootstrap playbook
  hosts: all
  vars:
    yq_version: v4.16.2
    yq_binary: yq_linux_amd64
  tasks:
  - name: Add open5gs latest repository from PPA and install its signing key on Ubuntu target
    ansible.builtin.apt_repository:
      repo: ppa:open5gs/latest
      update_cache: yes
  - name: Upgrade the OS (apt-get upgrade)
    apt:
      upgrade: "yes"
  - name: Install the package "software-properties-common"
    apt:
      name: software-properties-common
  - name: Install the required packages for open5gs setup
    apt:
      name: open5gs
  - name: Download nodejs-14 ppa source setup script
    get_url:
      url: https://deb.nodesource.com/setup_14.x
      dest: /tmp/setup_14.x
  - name: Install nodejs-14 ppa repository setup script
    shell: bash /tmp/setup_14.x
  - name: Install the package "nodejs"
    apt:
      name: nodejs
      update_cache: yes
  - name: Download open5gs-webui install script 
    get_url:
      url: https://open5gs.org/open5gs/assets/webui/install
      dest: /tmp/install-webui
  - name: Install Open5gs WebUI 
    shell: bash /tmp/install-webui
  - name : Download yq tool for YAML editing
    get_url:
      url: https://github.com/mikefarah/yq/releases/download/{{ yq_version }}/{{ yq_binary }}
      dest: /usr/bin/yq
      mode: +x
      checksum: sha1:57e8bbf5342be07a122abb1513c53f3a178240f9
  - name: Test yq installation
    shell: yq --version